From b3d00b452467f621317953d9e4c6f9ae8dcfd271 Mon Sep 17 00:00:00 2001
From: Imre Kaloz <kaloz@openwrt.org>
Date: Fri, 7 Jul 2017 17:06:55 +0200
Subject: use the openwrt lzma options for now

lede-commit: 548de949f392049420a6a1feeef118b30ab8ea8c
Signed-off-by: Imre Kaloz <kaloz@openwrt.org>
---
 lib/decompress.c              |  1 +
 scripts/Makefile.lib          |  2 +-
 usr/gen_initramfs_list.sh | 10 +++++-----
 3 files changed, 7 insertions(+), 6 deletions(-)

--- a/lib/decompress.c
+++ b/lib/decompress.c
@@ -53,6 +53,7 @@ static const struct compress_format comp
 	{ .magic = {0x1f, 0x9e}, .name = "gzip", .decompressor = gunzip },
 	{ .magic = {0x42, 0x5a}, .name = "bzip2", .decompressor = bunzip2 },
 	{ .magic = {0x5d, 0x00}, .name = "lzma", .decompressor = unlzma },
+	{ .magic = {0x6d, 0x00}, .name = "lzma-openwrt", .decompressor = unlzma },
 	{ .magic = {0xfd, 0x37}, .name = "xz", .decompressor = unxz },
 	{ .magic = {0x89, 0x4c}, .name = "lzo", .decompressor = unlzo },
 	{ .magic = {0x02, 0x21}, .name = "lz4", .decompressor = unlz4 },
--- a/scripts/Makefile.lib
+++ b/scripts/Makefile.lib
@@ -348,7 +348,7 @@ quiet_cmd_bzip2_with_size = BZIP2   $@
 # ---------------------------------------------------------------------------
 
 quiet_cmd_lzma = LZMA    $@
-      cmd_lzma = cat $(real-prereqs) | $(LZMA) -9 > $@
+      cmd_lzma = { cat $(real-prereqs) | $(LZMA) e -d20 -lc1 -lp2 -pb2 -eos -si -so; $(size_append); } > $@
 
 quiet_cmd_lzma_with_size = LZMA    $@
       cmd_lzma_with_size = { cat $(real-prereqs) | $(LZMA) -9; $(size_append); } > $@
